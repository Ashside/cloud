<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiniMind Training Lab</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
     <div class="header">
         <img src="/static/images/logo2.png" alt="MiniMind Logo" class="logo">
         <h1>MiniMind Training Lab</h1>
     </div>
    
    <div class="tabs">
        <button class="tab active" onclick="openTab(event, 'train')">开始训练</button>
        <button class="tab" onclick="openTab(event, 'processes')">训练进程</button>
        <button class="tab" onclick="openTab(event, 'logfiles')">日志文件</button>
        <button class="tab" onclick="openTab(event, 'eval')">模型评测</button>
        <button class="tab" onclick="openTab(event, 'lora-exchange')">LoRA 联训</button>
        {% if transfer_debug %}
        <button class="tab" onclick="openTab(event, 'transfer')">跨服传输（调试）</button>
        {% endif %}
    </div>
    
    <div id="train" class="tab-content">
        <div class="form-container">
            <h2 class="section-title">选择训练类型并配置参数</h2>
            <form id="train-form" method="post" action="/train">
                <!-- 基础训练参数 -->
                <div class="parameter-card">
                    <h3 class="card-title">基础训练参数</h3>
                    <div class="parameter-content">
                        <div class="form-group">
                    <label for="train_type">训练类型：</label>
                    <select id="train_type" name="train_type" required>
                        <option value="pretrain">🔤 Pretrain</option>
                        <option value="sft">🎯 SFT - Full</option>
                        <option value="lora">⚡ SFT - Lora</option>
                        <option value="dpo">🧠 RL - DPO</option>
                        <option value="ppo">🚀 RL - PPO</option>
                        <option value="grpo">💡 RL - GRPO</option>
                        <option value="spo">🔍 RL - SPO</option>
                    </select>
                </div>
                        <div class="form-group">
                            <label for="epochs">训练轮数：</label>
                            <input type="number" id="epochs" name="epochs" min="1" value="10" required>
                        </div>
                        <div class="form-group">
                            <label for="batch_size">Batch Size：</label>
                            <input type="number" id="batch_size" name="batch_size" min="1" value="32" required>
                        </div>
                        <div class="form-group">
                            <label for="learning_rate">学习率：</label>
                            <input type="text" id="learning_rate" name="learning_rate" value="5e-4" required>
                        </div>
                        <div class="form-group">
                            <label for="log_interval">日志打印间隔：</label>
                            <input type="number" id="log_interval" name="log_interval" min="1" value="100" required>
                        </div>
                        <div class="form-group">
                            <label for="data_path">数据路径：</label>
                            <div class="input-with-picker">
                                <input type="text" id="data_path" name="data_path" value="./dataset" required>
                                <button type="button" class="btn-picker" onclick="selectFolder('data_path')" title="选择文件夹">
                                    📁
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 强化学习参数 -->
                <div class="parameter-card dpo" style="display: none;">
                    <h3 class="card-title">强化学习参数 (DPO)</h3>
                    <div class="parameter-content">
                        <div class="form-group">
                            <label for="beta">DPO Beta 参数：</label>
                            <input type="text" id="beta" name="beta" placeholder="0.1">
                        </div>
                    </div>
                </div>
                
                <!-- PPO强化学习参数 -->
                <div class="parameter-card ppo" style="display: none;">
                    <h3 class="card-title">强化学习参数 (PPO)</h3>
                    <div class="parameter-content">
                        <div class="form-group">
                            <label for="clip_epsilon">PPO剪切系数：</label>
                            <input type="text" id="clip_epsilon" name="clip_epsilon" placeholder="0.2">
                        </div>
                        <div class="form-group">
                            <label for="vf_coef">价值函数系数：</label>
                            <input type="text" id="vf_coef" name="vf_coef" placeholder="0.1">
                        </div>
                        <div class="form-group">
                            <label for="kl_coef">KL散度惩罚系数：</label>
                            <input type="text" id="kl_coef" name="kl_coef" placeholder="0.01">
                        </div>
                        <div class="form-group">
                            <label for="reasoning">是否使用Reasoning模式：</label>
                            <select id="reasoning" name="reasoning">
                                <option value="0">否</option>
                                <option value="1">是</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="update_old_actor_freq">更新旧Actor频率：</label>
                            <input type="number" id="update_old_actor_freq" name="update_old_actor_freq" placeholder="10" min="1">
                        </div>
                        <div class="form-group">
                            <label for="reward_model_path">奖励模型路径：</label>
                            <div class="input-with-picker">
                                <input type="text" id="reward_model_path" name="reward_model_path" placeholder="path/to/reward/model">
                                <button type="button" class="btn-picker" onclick="selectFolder('reward_model_path')" title="选择文件夹">
                                    📁
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- GRPO强化学习参数 -->
                <div class="parameter-card grpo" style="display: none;">
                    <h3 class="card-title">强化学习参数 (GRPO)</h3>
                    <div class="parameter-content">
                        <div class="form-group">
                            <label for="beta_grpo">GRPO KL惩罚系数：</label>
                            <input type="text" id="beta_grpo" name="beta" placeholder="0.02">
                        </div>
                        <div class="form-group">
                            <label for="num_generations">每个prompt生成样本数：</label>
                            <input type="number" id="num_generations" name="num_generations" placeholder="8" min="1">
                        </div>
                        <div class="form-group">
                            <label for="reasoning_grpo">是否使用Reasoning模式：</label>
                            <select id="reasoning_grpo" name="reasoning">
                                <option value="0">否</option>
                                <option value="1">是</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reward_model_path_grpo">奖励模型路径：</label>
                            <div class="input-with-picker">
                                <input type="text" id="reward_model_path_grpo" name="reward_model_path" placeholder="../../internlm2-1_8b-reward">
                                <button type="button" class="btn-picker" onclick="selectFolder('reward_model_path_grpo')" title="选择文件夹">
                                    📁
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SPO强化学习参数 -->
                <div class="parameter-card spo" style="display: none;">
                    <h3 class="card-title">强化学习参数 (SPO)</h3>
                    <div class="parameter-content">
                        <div class="form-group">
                            <label for="beta_spo">SPO KL惩罚系数：</label>
                            <input type="text" id="beta_spo" name="beta" placeholder="0.02">
                        </div>
                        <div class="form-group">
                            <label for="reasoning_spo">是否使用Reasoning模式：</label>
                            <select id="reasoning_spo" name="reasoning">
                                <option value="0">否</option>
                                <option value="1">是</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reward_model_path_spo">奖励模型路径：</label>
                            <div class="input-with-picker">
                                <input type="text" id="reward_model_path_spo" name="reward_model_path" placeholder="../../internlm2-1_8b-reward">
                                <button type="button" class="btn-picker" onclick="selectFolder('reward_model_path_spo')" title="选择文件夹">
                                    📁
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 模型结构参数 -->
                <div class="parameter-card">
                    <h3 class="card-title">模型结构参数</h3>
                    <div class="parameter-content">
                        <div class="form-group">
                            <label for="hidden_size">隐藏层维度：</label>
                            <input type="number" id="hidden_size" name="hidden_size" min="128" value="512" required>
                        </div>
                        <div class="form-group">
                            <label for="num_hidden_layers">隐藏层数量：</label>
                            <input type="number" id="num_hidden_layers" name="num_hidden_layers" min="1" value="8" required>
                        </div>
                        <div class="form-group">
                            <label for="max_seq_len">最大序列长度：</label>
                            <input type="number" id="max_seq_len" name="max_seq_len" min="64" value="512" required>
                        </div>
                        <div class="form-group">
                            <label for="use_moe">是否使用MoE架构：</label>
                            <select id="use_moe" name="use_moe">
                                <option value="0">❌ 否</option>
                                <option value="1">✅ 是</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- 模型保存与恢复 -->
                <div class="parameter-card">
                    <h3 class="card-title">模型保存与恢复</h3>
                    <div class="parameter-content">
                        <div class="form-group">
                            <label for="save_dir">模型保存目录：</label>
                            <div class="input-with-picker">
                                <input type="text" id="save_dir" name="save_dir" value="./checkpoints" required>
                                <button type="button" class="btn-picker" onclick="selectFolder('save_dir')" title="选择文件夹">
                                    📁
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="save_interval">模型保存间隔：</label>
                            <input type="number" id="save_interval" name="save_interval" min="1" value="1000" required>
                        </div>
                        <div class="form-group pretrain-sft">
                            <label for="save_weight">保存权重前缀名：</label>
                            <input type="text" id="save_weight" name="save_weight" value="model">
                        </div>
                        <div class="form-group lora">
                            <label for="lora_name">LoRA权重名称：</label>
                            <input type="text" id="lora_name" name="lora_name" value="lora_adapter">
                        </div>
                        <div class="form-group from-weight">
                            <label for="from_weight">基于哪个权重训练：</label>
                            <input type="text" id="from_weight" name="from_weight" value="pretrained_model">
                        </div>
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="from_resume" name="from_resume" value="1">
                                <label for="from_resume">是否自动检测&续训</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 其他设置 -->
                <div class="parameter-card">
                    <h3 class="card-title">其他设置</h3>
                    <div class="parameter-content">
                        <div class="form-group">
                            <label for="training_mode">训练方式：</label>
                            <select id="training_mode" name="training_mode" required>
                                <option value="single_gpu">🎮 单卡训练</option>
                                <option value="multi_gpu">🚀 多卡训练</option>
                                <option value="cpu">💻 CPU训练</option>
                            </select>
                        </div>
                        <div class="form-group" id="single-gpu-selection">
                            <label for="device">GPU序号：</label>
                            <input type="number" id="device" name="device" min="0" max="{{ gpu_count|default(1) - 1 }}" value="0" required>
                        </div>
                        <div class="form-group" id="multi-gpu-selection" style="display: none;">
                            <label for="gpu_num">多卡并行数：</label>
                            <div class="input-with-picker">
                                <input type="number" id="gpu_num" name="gpu_num" min="1" max="{{ gpu_count|default(1) }}" value="{{ gpu_count|default(1) }}" required>
                                <span class="hint-text">(可用GPU数量: {{ gpu_count|default(0) }})</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="train_monitor">训练监控：</label>
                            <select id="train_monitor" name="train_monitor">
                                <option value="none">❌ 无监控</option>
                                <option value="wandb">📊 使用WandB/SwanLab</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <script>
                    window.hasGpu = {{ has_gpu|default(false)|tojson|safe }};
                    window.gpuCount = {{ gpu_count|default(0)|tojson|safe }};
                    window.transferDebugEnabled = {{ transfer_debug|default(false)|tojson|safe }};
                </script>
                
                <div class="submit-container">
                    <button type="submit" class="btn-primary">
                        <span class="btn-icon">🚀</span>
                        开始训练
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="processes" class="tab-content hidden">
        <div class="section-header">
            <h2 class="section-title">训练进程列表</h2>
            <div class="section-actions">
                <button class="btn-refresh" onclick="refreshProcesses()">
                    <span class="btn-icon">🔄</span>
                    刷新
                </button>
            </div>
        </div>
        <div id="process-list">
            <!-- 进程列表将通过JavaScript动态加载 -->
        </div>
    </div>
    
    <div id="logfiles" class="tab-content hidden">
        <div class="section-header">
            <h2 class="section-title">日志文件列表</h2>
            <div class="section-actions">
                <button class="btn-refresh" onclick="refreshLogs()">
                    <span class="btn-icon">🔄</span>
                    刷新
                </button>
            </div>
        </div>
        <div id="logfiles-list">
            <!-- 日志文件列表将通过JavaScript动态加载 -->
        </div>
    </div>

    <div id="eval" class="tab-content hidden">
        <div class="section-header">
            <h2 class="section-title">模型评测 (基于 eval_llm.py)</h2>
            <div class="section-actions">
                <div class="tag">权重来源：out/；LoRA来源：out/lora/</div>
            </div>
        </div>
        <div class="transfer-grid">
            <div class="parameter-card">
                <h3 class="card-title">运行设置</h3>
                <div class="parameter-content transfer-content">
                    <div class="form-group">
                        <label for="eval-load-from">模型加载路径</label>
                        <input type="text" id="eval-load-from" value="model">
                        <small class="text-muted">等同 eval_llm.py --load_from</small>
                    </div>
                    <div class="form-group">
                        <label for="eval-weight">选择 out/ 权重</label>
                        <select id="eval-weight">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="eval-lora">选择 LoRA (可选)</label>
                        <select id="eval-lora">
                            <option value="None">不使用 LoRA</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="eval-hidden">隐藏维度</label>
                        <input type="number" id="eval-hidden" value="512" min="1">
                    </div>
                    <div class="form-group">
                        <label for="eval-layers">层数</label>
                        <input type="number" id="eval-layers" value="8" min="1">
                    </div>
                    <div class="form-group">
                        <label for="eval-max-tokens">最大生成长度</label>
                        <input type="number" id="eval-max-tokens" value="512" min="1">
                    </div>
                    <div class="form-group">
                        <label for="eval-temp">温度</label>
                        <input type="text" id="eval-temp" value="0.85">
                    </div>
                    <div class="form-group">
                        <label for="eval-top-p">Top-p</label>
                        <input type="text" id="eval-top-p" value="0.85">
                    </div>
                    <div class="form-group">
                        <label for="eval-historys">历史轮数</label>
                        <input type="number" id="eval-historys" value="0" min="0">
                    </div>
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="eval-use-moe">
                        <label for="eval-use-moe">使用 MoE (文件名含 _moe)</label>
                    </div>
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="eval-use-default">
                        <label for="eval-use-default">使用内置测试提示（忽略自定义prompt）</label>
                    </div>
                    <div class="form-group full-width">
                        <label for="eval-prompt">自定义 Prompt</label>
                        <textarea id="eval-prompt" rows="4" placeholder="请输入对话提示"></textarea>
                    </div>
                    <div class="form-group full-width">
                        <button type="button" class="btn-primary" id="btn-run-eval">
                            <span class="btn-icon">▶</span> 运行评测
                        </button>
                        <button type="button" class="btn-secondary" id="btn-refresh-eval-weights">刷新权重列表</button>
                    </div>
                </div>
            </div>

            <div class="parameter-card">
                <h3 class="card-title">输出结果</h3>
                <div class="logs-container" id="eval-results">
                    结果将在这里显示
                </div>
            </div>
        </div>
    </div>

    <div id="lora-exchange" class="tab-content hidden">
        <div class="section-header">
            <h2 class="section-title">跨区 LoRA 远程联训（A ↔ B）</h2>
            <div class="section-actions">
                <div class="tag">A（本机）只能选择 dataset/ 作为数据来源</div>
                <div class="tag">B（远端）仅开放 6006 / 6008</div>
            </div>
        </div>
        <div class="transfer-grid">
            <div class="parameter-card">
                <h3 class="card-title">发送到 B（权重 + 数据集 + 参数）</h3>
                <p class="transfer-subtitle">A → B：上传 out/ 权重、dataset/ 数据，触发远端 LoRA 训练</p>
                <div class="parameter-content transfer-content">
                    <div class="form-group full-width">
                        <label for="lora-remote-url">B 服务器 URL（建议 :6006 / :6008）</label>
                        <input type="text" id="lora-remote-url" placeholder="http://serverB:6006">
                    </div>
                    <div class="form-group full-width">
                        <label for="lora-token">鉴权令牌 (可选，与 B TRANSFER_TOKEN 一致)</label>
                        <input type="text" id="lora-token" placeholder="可选 token">
                    </div>
                    <div class="form-group">
                        <label for="lora-base-weight">选择 out/ 权重</label>
                        <select id="lora-base-weight">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lora-dataset">选择 dataset/ 数据文件</label>
                        <select id="lora-dataset">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="form-group inline-actions">
                        <button type="button" class="btn-secondary" id="btn-refresh-lora-lists">刷新列表</button>
                        <button type="button" class="btn-secondary" id="btn-lora-ping">Ping B</button>
                    </div>
                    <div class="form-group">
                        <label for="lora-name">LoRA 名称</label>
                        <input type="text" id="lora-name" value="remote_lora">
                    </div>
                    <div class="form-group">
                        <label for="lora-epochs">轮数</label>
                        <input type="number" id="lora-epochs" value="10" min="1">
                    </div>
                    <div class="form-group">
                        <label for="lora-batch">Batch Size</label>
                        <input type="number" id="lora-batch" value="16" min="1">
                    </div>
                    <div class="form-group">
                        <label for="lora-lr">学习率</label>
                        <input type="text" id="lora-lr" value="1e-4">
                    </div>
                    <div class="form-group">
                        <label for="lora-hidden">隐藏维度</label>
                        <input type="number" id="lora-hidden" value="512" min="1">
                    </div>
                    <div class="form-group">
                        <label for="lora-maxlen">最大序列长度</label>
                        <input type="number" id="lora-maxlen" value="512" min="1">
                    </div>
                    <div class="form-group">
                        <label for="lora-save-interval">保存间隔</label>
                        <input type="number" id="lora-save-interval" value="1" min="1">
                    </div>
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="lora-overwrite">
                        <label for="lora-overwrite">允许覆盖 B 端同名文件</label>
                    </div>
                    <div class="form-group full-width">
                        <button type="button" class="btn-primary" id="btn-start-remote-lora">
                            <span class="btn-icon">🚀</span> 启动远程 LoRA 训练
                        </button>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-info">
                        <span id="lora-upload-weight-status">权重上传：等待</span>
                        <span id="lora-upload-weight-progress">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="lora-upload-weight-fill" style="width: 0%;"></div>
                    </div>
                    <div class="progress-info">
                        <span id="lora-upload-dataset-status">数据集上传：等待</span>
                        <span id="lora-upload-dataset-progress">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="lora-upload-dataset-fill" style="width: 0%;"></div>
                    </div>
                </div>
            </div>

            <div class="parameter-card">
                <h3 class="card-title">等待 B 完成并回传</h3>
                <p class="transfer-subtitle">B 完成后可自动回传，也可手动拉取</p>
                <div class="parameter-content transfer-content">
                    <div class="form-group full-width">
                        <label>回传地址（本机）</label>
                        <input type="text" id="lora-callback-url" placeholder="http://serverA:6006" value="">
                        <small class="text-muted">默认使用当前页面域名</small>
                    </div>
                    <div class="form-group full-width">
                        <label for="lora-callback-token">回传鉴权 (可选)</label>
                        <input type="text" id="lora-callback-token" placeholder="可选 token">
                    </div>
                    <div class="form-group">
                        <label for="lora-remote-task">远程任务ID</label>
                        <input type="text" id="lora-remote-task" readonly placeholder="等待启动">
                    </div>
                    <div class="form-group">
                        <label for="lora-remote-result">远端结果文件（相对 out/）</label>
                        <input type="text" id="lora-remote-result" readonly placeholder="等待启动">
                    </div>
                    <div class="form-group inline-actions">
                        <button type="button" class="btn-secondary" id="btn-poll-remote-lora">查询远程状态</button>
                        <button type="button" class="btn-secondary" id="btn-download-lora">手动拉取回传</button>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-info">
                        <span id="lora-remote-status-text">等待任务</span>
                        <span id="lora-remote-progress-number">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="lora-remote-progress-fill" style="width: 0%;"></div>
                    </div>
                    <div class="progress-info">
                        <span id="lora-remote-detail-text" class="text-muted"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% if transfer_debug %}
    <div id="transfer" class="tab-content hidden">
        <div class="section-header">
            <h2 class="section-title">跨服务器模型传输</h2>
            <div class="section-actions">
                <div class="tag">本地 out 路径：<code id="local-out-base">./out</code></div>
                <div class="tag">autodl 仅 6006/6008 端口开放（跨区：西北B ↔ 北京B）</div>
            </div>
        </div>
        <div class="transfer-grid">
            <div class="parameter-card">
                <h3 class="card-title">发送到远程服务器</h3>
                <p class="transfer-subtitle">A → B：仅可从本地 out 目录中选择权重文件并推送</p>
                <div class="parameter-content transfer-content">
                    <div class="form-group full-width">
                        <label for="upload-remote-url">目标服务器URL（建议 6006/6008）</label>
                        <input type="text" id="upload-remote-url" placeholder="http://serverB:6006">
                    </div>
                    <div class="form-group full-width">
                        <label for="upload-token">鉴权令牌 (可选，需与对端 TRANSFER_TOKEN 一致)</label>
                        <input type="text" id="upload-token" placeholder="可选token">
                    </div>
                    <div class="form-group">
                        <label for="upload-file-select">选择 out 目录文件</label>
                        <select id="upload-file-select">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="form-group inline-actions">
                        <button type="button" class="btn-secondary" id="btn-refresh-out">刷新本地列表</button>
                        <button type="button" class="btn-secondary" id="btn-ping-remote">Ping 远程</button>
                    </div>
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="upload-overwrite">
                        <label for="upload-overwrite">允许远端覆盖同名文件</label>
                    </div>
                    <div class="form-group full-width">
                        <button type="button" class="btn-primary" id="btn-start-upload">
                            <span class="btn-icon">📤</span>
                            发送到远端
                        </button>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-info">
                        <span id="upload-status-text">等待任务</span>
                        <span id="upload-progress-number">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="upload-progress-fill" style="width: 0%;"></div>
                    </div>
                    <div class="progress-info">
                        <span id="upload-detail-text" class="text-muted"></span>
                    </div>
                </div>
            </div>

            <div class="parameter-card">
                <h3 class="card-title">从远程接收/拉取</h3>
                <p class="transfer-subtitle">B ← A：从远端 out 目录拉取到本地 out</p>
                <div class="parameter-content transfer-content">
                    <div class="form-group full-width">
                        <label for="download-remote-url">来源服务器URL（建议 6006/6008）</label>
                        <input type="text" id="download-remote-url" placeholder="http://serverA:6006">
                    </div>
                    <div class="form-group full-width">
                        <label for="download-token">鉴权令牌 (可选)</label>
                        <input type="text" id="download-token" placeholder="可选token">
                    </div>
                    <div class="form-group">
                        <label for="download-file-select">远程 out 目录文件</label>
                        <select id="download-file-select">
                            <option value="">请先加载远程列表</option>
                        </select>
                    </div>
                    <div class="form-group inline-actions">
                        <button type="button" class="btn-secondary" id="btn-load-remote-list">加载远程列表</button>
                    </div>
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="download-overwrite">
                        <label for="download-overwrite">允许覆盖本地同名文件</label>
                    </div>
                    <div class="form-group full-width">
                        <button type="button" class="btn-primary" id="btn-start-download">
                            <span class="btn-icon">📥</span>
                            下载到本地 out
                        </button>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-info">
                        <span id="download-status-text">等待任务</span>
                        <span id="download-progress-number">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="download-progress-fill" style="width: 0%;"></div>
                    </div>
                    <div class="progress-info">
                        <span id="download-detail-text" class="text-muted"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- 文件浏览器模态框 -->
    <div id="file-browser-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">选择文件或文件夹</h3>
                <button class="modal-close" onclick="closeFileBrowser()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="file-browser-nav">
                    <div class="current-path" id="current-path">./</div>
                    <div class="nav-buttons">
                        <button class="btn-navigate" onclick="selectCurrentDirectory()" title="选择当前目录">📍</button>
                        <button class="btn-navigate" onclick="navigateToParent()" title="上级目录">⬆️</button>
                    </div>
                </div>
                <div class="quick-paths" id="quick-paths">
                    <!-- 快捷路径将在这里显示 -->
                </div>
                <div class="file-browser-help">
                    💡 点击文件夹进入目录，点击文件选择文件，使用📍选择当前目录
                </div>
                <div class="file-list" id="file-list">
                    <!-- 文件列表将在这里显示 -->
                </div>
            </div>
            <div class="modal-footer">
                <input type="text" id="selected-path" placeholder="选择的文件或文件夹路径" readonly>
                <button class="btn-primary" onclick="confirmFileSelection()">确认选择</button>
                <button class="btn-secondary" onclick="closeFileBrowser()">取消</button>
            </div>
        </div>
    </div>
    
    <script type="module" src="/static/js/app.js"></script>
</body>
</html>
